{% if site.enable_mansory %}
<!-- Mansory & imagesLoaded - Optimized Loading -->
<script>
  // Only load masonry if grid elements are present
  document.addEventListener('DOMContentLoaded', function() {
    if (document.querySelector('.grid')) {
      // Load masonry scripts with better error handling
      const loadScript = (src) => {
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = src;
          script.defer = true;
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      };
      
      // Load scripts in parallel for faster execution
      Promise.all([
        loadScript('https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js'),
        loadScript('https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js'),
        loadScript('{{ "/assets/js/mansory.js" | relative_url }}')
      ]).catch(error => console.warn('Masonry loading failed:', error));
    }
  });
</script>
{% endif %}
